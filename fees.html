<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fee Receipt Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background: linear-gradient(135deg, #e0eafc, #cfdef3);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .container {
      max-width: 1200px;
      width: 100%;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      padding: 30px;
      margin-bottom: 20px;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 2.2em;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .form-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      color: #34495e;
      margin-bottom: 8px;
    }

    input, select {
      padding: 12px;
      border: 1px solid #dfe6e9;
      border-radius: 8px;
      font-size: 1em;
      transition: border-color 0.3s, box-shadow 0.3s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: #0984e3;
      box-shadow: 0 0 8px rgba(9, 132, 227, 0.3);
    }

    button {
      background: #0984e3;
      color: #fff;
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 1.1em;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      display: block;
      margin: 20px auto;
    }

    button:hover {
      background: #0652dd;
      transform: translateY(-2px);
    }

    .receipt-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
    }

    .receipt {
      width: 100%;
      max-width: 500px;
      background: #fff;
      border: 2px solid #dfe6e9;
      border-radius: 10px;
      padding: 20px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      position: relative;
      overflow: hidden;
    }

    .receipt::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
      background: linear-gradient(to right, #0984e3, #00cec9);
    }

    .receipt-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .receipt-header img {
      max-width: 100px;
      margin-bottom: 10px;
    }

    .receipt-header h2 {
      color: #2c3e50;
      font-size: 1.8em;
      margin-bottom: 5px;
    }

    .receipt-header p {
      color: #7f8c8d;
      font-size: 0.9em;
    }

    .receipt-body {
      margin-bottom: 20px;
    }

    .receipt-body p {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px dashed #dfe6e9;
      font-size: 0.95em;
      color: #34495e;
    }

    .receipt-body p span:first-child {
      font-weight: 600;
    }

    .receipt-footer {
      text-align: center;
      font-size: 0.85em;
      color: #7f8c8d;
      border-top: 1px solid #dfe6e9;
      padding-top: 10px;
    }

    @media print {
      body {
        background: none;
      }

      .container, button {
        display: none;
      }

      .receipt-container {
        display: flex;
        flex-direction: row;
        gap: 20px;
      }

      .receipt {
        box-shadow: none;
        border: 1px solid #000;
        page-break-inside: avoid;
      }
    }

    @media (max-width: 768px) {
      .form-section {
        grid-template-columns: 1fr;
      }

      .receipt {
        max-width: 100%;
      }

      .receipt-container {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Fee Receipt Generator</h1>
    <div class="form-section">
      <div class="form-group">
        <label for="studentName">Student Name</label>
        <input type="text" id="studentName" placeholder="Enter student name" required>
      </div>
      <div class="form-group">
        <label for="fatherName">Father's Name</label>
        <input type="text" id="fatherName" placeholder="Enter father's name" required>
      </div>
      <div class="form-group">
        <label for="rollNumber">Roll Number</label>
        <input type="text" id="rollNumber" placeholder="Enter roll number" required>
      </div>
      <div class="form-group">
        <label for="class">Class</label>
        <input type="text" id="class" placeholder="Enter class" required>
      </div>
      <div class="form-group">
        <label for="section">Section</label>
        <input type="text" id="section" placeholder="Enter section" required>
      </div>
      <div class="form-group">
        <label for="feeAmount">Fee Amount</label>
        <input type="number" id="feeAmount" placeholder="Enter fee amount" required>
      </div>
      <div class="form-group">
        <label for="paymentDate">Payment Date</label>
        <input type="date" id="paymentDate" required>
      </div>
      <div class="form-group">
        <label for="paymentMode">Payment Mode</label>
        <select id="paymentMode" required>
          <option value="Cash">Cash</option>
          <option value="Online">Online</option>
          <option value="Cheque">Cheque</option>
        </select>
      </div>
    </div>
    <button onclick="generateReceipt()">Generate Receipt</button>
  </div>

  <div class="receipt-container" id="receiptContainer"></div>

  <script>
    function generateReceipt() {
      const studentName = document.getElementById('studentName').value;
      const fatherName = document.getElementById('fatherName').value;
      const rollNumber = document.getElementById('rollNumber').value;
      const className = document.getElementById('class').value;
      const section = document.getElementById('section').value;
      const feeAmount = document.getElementById('feeAmount').value;
      const paymentDate = document.getElementById('paymentDate').value;
      const paymentMode = document.getElementById('paymentMode').value;

      if (!studentName || !fatherName || !rollNumber || !className || !section || !feeAmount || !paymentDate || !paymentMode) {
        alert('Please fill all fields.');
        return;
      }

      const receiptNumber = 'REC' + Math.floor(1000 + Math.random() * 9000);
      const currentDate = new Date(paymentDate).toLocaleDateString('en-GB', {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric'
      });

      const receiptTemplate = () => `
        <div class="receipt">
          <div class="receipt-header">
            <img src="https://via.placeholder.com/100x100.png?text=School+Logo" alt="School Logo" crossorigin="anonymous">
            <h2>Sunrise International School</h2>
            <p>123 Academic Avenue, Education City, EC 12345</p>
            <p>Contact: (123) 456-7890 | Email: info@sunriseschool.org</p>
          </div>
          <div class="receipt-body">
            <p><span>Receipt Number:</span> <span>${receiptNumber}</span></p>
            <p><span>Student Name:</span> <span>${studentName}</span></p>
            <p><span>Father's Name:</span> <span>${fatherName}</span></p>
            <p><span>Roll Number:</span> <span>${rollNumber}</span></p>
            <p><span>Class:</span> <span>${className}</span></p>
            <p><span>Section:</span> <span>${section}</span></p>
            <p><span>Fee Amount:</span> <span>$${parseFloat(feeAmount).toFixed(2)}</span></p>
            <p><span>Payment Date:</span> <span>${currentDate}</span></p>
            <p><span>Payment Mode:</span> <span>${paymentMode}</span></p>
          </div>
          <div class="receipt-footer">
            <p>Authorized Signatory</p>
            <p>Thank you for your payment!</p>
          </div>
        </div>
      `;

      const receiptContainer = document.getElementById('receiptContainer');
      receiptContainer.innerHTML = receiptTemplate() + receiptTemplate();
      
      // Remove existing download button if present
      const existingButton = document.querySelector('button[onclick="downloadPDF()"]');
      if (existingButton) existingButton.remove();

      // Add Download PDF button
      const downloadButton = document.createElement('button');
      downloadButton.textContent = 'Download PDF';
      downloadButton.onclick = downloadPDF;
      receiptContainer.insertAdjacentElement('afterend', downloadButton);
    }

    function downloadPDF() {
      if (!window.jspdf || !window.html2canvas) {
        alert('Required libraries failed to load. Please check your internet connection and try again.');
        return;
      }

      const { jsPDF } = window.jspdf;
      const receipts = document.querySelectorAll('.receipt');
      if (receipts.length !== 2) {
        alert('Error: Expected two receipts.');
        return;
      }

      const margin = 10; // Margin in mm
      const spacing = 10; // Spacing between receipts in mm
      let maxWidth = 0;
      let totalHeight = 0;
      const receiptDimensions = [];

      // Calculate dimensions for each receipt
      let promiseChain = Promise.resolve();

      receipts.forEach(receipt => {
        promiseChain = promiseChain.then(() => {
          return html2canvas(receipt, {
            scale: 2,
            useCORS: true,
            logging: false,
            backgroundColor: '#ffffff'
          }).then(canvas => {
            const imgWidth = canvas.width / 2; // Adjust for scale
            const imgHeight = canvas.height / 2;
            const mmWidth = (imgWidth * 25.4) / 96; // Convert pixels to mm (96 DPI)
            const mmHeight = (imgHeight * 25.4) / 96;
            receiptDimensions.push({ canvas, mmWidth, mmHeight });
            maxWidth = Math.max(maxWidth, mmWidth);
            totalHeight += mmHeight;
          });
        });
      });

      promiseChain.then(() => {
        // Calculate PDF page size
        const pdfWidth = maxWidth + 2 * margin;
        const pdfHeight = totalHeight + 2 * margin + spacing;

        const doc = new jsPDF({
          orientation: 'portrait',
          unit: 'mm',
          format: [pdfWidth, pdfHeight] // Dynamic page size based on receipts
        });

        // Add receipts to PDF
        let currentY = margin;
        receiptDimensions.forEach(({ canvas, mmWidth, mmHeight }, index) => {
          const imgData = canvas.toDataURL('image/png');
          const ratio = maxWidth / mmWidth; // Scale to match max width
          const width = mmWidth * ratio;
          const height = mmHeight * ratio;
          const x = margin + (maxWidth - width) / 2; // Center horizontally

          doc.addImage(imgData, 'PNG', x, currentY, width, height);
          currentY += height + (index === 0 ? spacing : 0);
        });

        doc.save(`Fee_Receipt_${new Date().toISOString().split('T')[0]}.pdf`);
      }).catch(error => {
        console.error('Error generating PDF:', error);
        alert('Failed to generate PDF. Please ensure the page is fully loaded and try again.');
      });
    }

    // Set today's date as default for payment date
    document.getElementById('paymentDate').value = new Date().toISOString().split('T')[0];
  </script>
</body>
</html>
